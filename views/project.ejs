<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Project - <%=project.name%></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="../css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <link rel="stylesheet" href="/css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/codemirror.css">

        <script src="/js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>        
    </head>
    <body ng-app="myApp">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
            <a class="brand" href="/">CC-Edit</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">Download as Zip</a></li>
                <li><a href="#contact">Share</a></li>
              </ul>            
              <ul class="nav pull-right">
                <li class="dropdown ">
                  <a href="#" class="navbar-link dropdown-toggle" data-toggle="dropdown"><%= user.username %> <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="#">Account Info</a></li>
                    <li class="divider"></li>
                    <li><a href="/logout">Logoff</a></li>
                  </ul>
                </li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </div>
      </div>

      
        <div id="wrap" class="container-fluid">      
          
          <div class="row-fluid">

            <!-- ### FILE LLIST ### -->
            <div class="span2" ng-controller="ProjectCtrl">
              <div class="well sidebar-nav">
                <ul id="project-files" class="nav nav-list">
                  <li class="nav-header">Files <button class="close" type="button">+</button></li>
                  <!--<li class="active"><a href="#">Sample file</a></li>-->
                  <li ng-repeat="file in project.files">
                    <a ng-click="openFile(file.fileId)" href="#">{{file.fileName}}</a>
                  </li>
                </ul>
              </div><!--/.well -->
            </div><!--/span-->

            <!-- ### CODE AREA ### -->
            <div class="span8" ng-controller="FileCtrl">

              <div class="tabbable"> <!-- Only required for left/right tabs -->
                <ul class="nav nav-tabs">
                  <li ng-repeat="file in openFiles" ng-class="{active: file._id == activeFile._id }"><!--class="active"-->
                    <!-- moved the change tab code from bootstrp to angular js, due to need for getting currently active tab -->
                    <a data-toggle="tab" ng-click="changeActiveFile(file._id)">{{file.name}}<button class="close" type="button" ng-click="closeFile(file._id)">Ã—</button></a> <!--href="#{{file._id}}" -->
                  </li>
                </ul>
                <div><!-- class="tab-content"> -->
                  
                  <div class="tab-pane" class="active">                  
                    <div id="code-content" class="hero-unit">
                      <textarea ui-codemirror="{lineNumbers: 'true', mode:'htmlmixed'}" ng-model="activeFile.contents" ng-modal-instant ng-change="sendUpdatedFile()"></textarea>                      
                    </div>
                    <div class="row-fluid">            
                    </div><!--/row-->


                  </div>
                  <!--<div class="tab-pane" id="tab2">
                    <p>file 2</p>
                  </div>-->
                </div>
              </div>
            </div><!--/span-->

            <!-- ### ONLINE USERS ### -->
            <div class="span2" ng-controller="ChatCtrl">
            <div>
              <div class="well sidebar-nav">
                <ul id="online-users" class="nav nav-list">
                  <li class="nav-header">Online Users</li>
                  <li ng-repeat="user in onlineUsers">{{user}}</li>
                </ul>
              </div><!--/.well -->
            </div><!--/span-->

            <!-- ### CHAT BAR ### -->
            <div>
              <div class="well sidebar-nav">
                <ul class="nav nav-list">
                  <li class="nav-header">Chat</li>
                  <li ng-repeat='notification in chatNotifications' class="alert alert-info">
                     {{notification}} 
                  </li>
                  <li id="messages" ng-repeat="log in chatLog">
                    <b>{{log.username}}:</b> {{log.data}}
                  </li>
                </ul>
                <textarea id="chat-text" rows="4" ng-model='chatText'></textarea>
                <input type="button" value="Send" id="send-button" ng-click='sendChat()'>
                
              </div><!--/.well -->
            </div><!--/span-->        
          </div>

          </div><!--/row-->
          
          <hr>
          <footer>
              <p>&copy; Company 2012</p>
          </footer>      

        </div> <!-- /container -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../js/vendor/jquery-1.8.0.min.js"><\/script>')</script>

        <script src="/socket.io/socket.io.js"></script>
        <script src="/js/vendor/bootstrap.min.js"></script>
        <script src="/js/vendor/diff_match_patch.js"></script>

        <script src="/js/vendor/codemirror-compressed.js"></script>
        
        <!--http://ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular.min.js -->
        <script src="/js/vendor/angular.min.js"></script>
        <script src="/js/app.js"></script>
        <script src="/js/services.js"></script>
        <script src="/js/controllers.js"></script>
        <script src="/js/filters.js"></script>
        <script src="/js/directives.js"></script>

        <script src="/js/plugins.js"></script>
        <script src="/js/main.js"></script>

        <!--<script src="../nowjs/now.js"></script> -->

        <script>
          $(document).ready(function(){
          });
        </script>

        <!-- Google Analytics Code -->
        <script>
            /*var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));*/
        </script>



        <script>

          var username = "<%= user.username %>";

            /**************************
            * MISC FUNCTIONS
            **************************/
            function getDiff(text1, text2) {
              var dmp = new diff_match_patch();
              dmp.Diff_Timeout = 1;
              dmp.Diff_EditCost = 4;

              var d = dmp.diff_main(text1, text2);

              //dmp.diff_cleanupSemantic(d);
              dmp.diff_cleanupEfficiency(d);

              var ds = dmp.diff_prettyHtml(d);
              return ds;
            }

            /*http://jsperf.com/htmlencoderegex */
            function htmlEscape(str) {
                return String(str)
                        .replace(/&/g, '&amp;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#39;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;');
            }
        </script>

    </body>
</html>
